#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Scanning for secrets..."
node scripts/detect-secrets.js

if [ $? -ne 0 ]; then
  echo ""
  echo "âŒ Pre-commit check failed. Commit blocked."
  echo "Run 'git show :FILE_PATH' to view staged content"
  exit 1
fi

echo "âœ… No secrets detected"
echo ""

if node -e "const fs=require('fs'); const pkg=JSON.parse(fs.readFileSync('package.json','utf8')); process.exit(pkg['lint-staged'] ? 0 : 1)"; then
  npx lint-staged
else
  echo "â„¹ï¸  Skipping lint-staged (no configuration found)"
fi
